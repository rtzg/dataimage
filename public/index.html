<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="color-scheme" content="light dark">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DI</title>
    <link rel="stylesheet" href="res/style.css">

</head>

<body class="Bbody">
    <div id="prw"></div>
    <center>
        <form action="/upload" method="post" name="file" enctype="multipart/form-data">
            <h1>上传</h1>
            <label>
                <div class="btn" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);">上传</div>
                <input onchange="change(this.value)" type="file" name="file" id="file" accept=".png,.svg,.gif,.jpg,.jpeg,.webp">
            </label>
            <p>未选择文件</p>
            <br>
            <button>提交</button>
            <p>使用该项目即代表您同意<a href="./ut">用户协议</a></p>
        </form>
    </center>
    <script>
        var change = e => {
            if (!e == '') {
                document.getElementsByTagName('p')[0].innerHTML = e.split(`fakepath\\`)[1];
                previewImage();
            } else {
                document.getElementsByTagName('p')[0].innerHTML = '未选择文件';
            }
        }

        function dropHandler(ev) {
            ev.preventDefault();
            if (ev.dataTransfer.files.length > 1) {
                document.getElementsByTagName('p')[0].innerHTML = '请单选文件';
            } else {
                document.getElementById('file').files = ev.dataTransfer.files;
                document.getElementsByTagName('p')[0].innerHTML = ev.dataTransfer.files[0].name;
            }
            previewImage();
        }

        function dragOverHandler(ev) {
            ev.preventDefault();
        }

        function previewImage() {
            const input = document.getElementById('file');
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('prw').style.backgroundImage = `url(${e.target.result})`
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
</body>

</html>